# Configuration file for dnsmasq.
# See "/usr/sbin/dnsmasq --help" or "man 8 dnsmasq" for details.
# {{ansible_managed}}

interface={{ dnsmasq_interface }}	# listen (+ lo)
# bind-dynamic

user=dnsmasq	# Drop privs
group=dip

log-facility=/var/log/dnsmasq
log-async

# DNS
domain-needed		# Only forward FQDNs to upstream DNS
bogus-priv		# Never forward private-IP reverse lookups
bogus-nxdomain=64.94.110.11	# Verisign
bogus-nxdomain=104.239.213.7	# Level3
bogus-nxdomain=198.105.254.11	# Level3
stop-dns-rebind		# Reject private IPs from upstream servers
rebind-localhost-ok	# ... except for 127.0.0.0/8 (for ad/spam blockers)
filterwin2k		# Filter useless requests from Windows
expand-hosts		# Add domain to names from /etc/hosts
conntrack		# Accting: inbound req + outbound upstream
cache-size=200		# Number of DNS results
#local-ttl=600		# Clients cache DNS results for this long

# Upstream DNS servers
no-resolv		# only use specified servers
servers-file=/etc/dnsmasq.d/.servers

hostsdir={{ dnsmasq_dirs.hosts }}

#auth-zone={{ dnsmasq_domain }},{{ dnsmasq_interface }}/6
#auth-sec-servers={{ dnsmasq_dns2 }}

# DHCP
{% for domain in dnsmasq_domains %}
domain={{ domain }}
{% endfor %}

{% for range in dnsmasq_dhcp_ranges %}
dhcp-range={{ range }}
{% endfor %}

dhcp-hostsdir={{ dnsmasq_dirs.dhcp-hosts }}
dhcp-optsdir={{ dnsmasq_dirs.dhcp-opts }}

quiet-dhcp		# don't log DHCP traffic
localmx			# Mailhost is this server
dhcp-generate-names	# Use MAC to make a name if not supplied by client
dhcp-authoritative	# No other DHCP servers on this interface

{% for alias, target in dnsmasq_cnames.iteritems() %}
cname={{ alias }},{{ target }}
{% endfor %}
